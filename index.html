<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Ether VS Al_Amin</title>
<style>
body{
    margin:0;
    overflow:hidden;
    background:#000000;
}
canvas{
    display:block;
    margin:auto;
    background:#050606;
}
</style>
</head>
<body>

<canvas id="gameCanvas" width="400" height="600"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

// Images
const birdImg = new Image();
birdImg.src = "me.png";

// Sounds
const tapSound = new Audio("tap.mp3");
const gameOverSound = new Audio("end.mp3");
tapSound.load();
gameOverSound.load();

let bird = {
    x: 80,
    y: 200,
    width: 40,
    height: 40,
    gravity: 0.4,
    lift: -10,
    velocity: 0
};

let pipes = [];
let frame = 0;
let score = 0;
let gameOver = false;
let canRestart = false;      
let gameOverPlayed = false;

// Ensure first user click unlocks sound
let firstClick = false;

document.addEventListener("click", () => {
    if(!firstClick){
        // Some browsers require play after interaction
        tapSound.play().catch(()=>{});
        gameOverSound.play().catch(()=>{ gameOverSound.pause(); gameOverSound.currentTime=0; });
        firstClick = true;
    }

    if(!gameOver){
        bird.velocity = bird.lift;
        tapSound.currentTime = 0;
        tapSound.play().catch(()=>{}); // fallback if blocked
    } else if(canRestart){
        location.reload();
    }
});

function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // Bird physics
    bird.velocity += bird.gravity;
    bird.y += bird.velocity;

    // Draw bird
    ctx.save();
    ctx.beginPath();
    ctx.arc(bird.x + bird.width/2, bird.y + bird.height/2, bird.width/2, 0, Math.PI*2);
    ctx.closePath();
    ctx.clip();
    ctx.drawImage(birdImg, bird.x, bird.y, bird.width, bird.height);
    ctx.restore();

    // Pipes
    if(frame % 100 === 0){
        let topHeight = Math.random() * 250 + 50;
        pipes.push({
            x: canvas.width,
            top: topHeight,
            gap: 150,
            width: 50,
            passed: false
        });
    }

    pipes.forEach(pipe => {
        pipe.x -= 3;

        ctx.fillStyle = "green";
        ctx.fillRect(pipe.x, 0, pipe.width, pipe.top);
        ctx.fillRect(pipe.x, pipe.top + pipe.gap, pipe.width, canvas.height - pipe.top - pipe.gap);

        if(
            bird.x < pipe.x + pipe.width &&
            bird.x + bird.width > pipe.x &&
            (bird.y < pipe.top || bird.y + bird.height > pipe.top + pipe.gap)
        ){
            gameOver = true;
        }

        if(!pipe.passed && pipe.x + pipe.width < bird.x){
            score += 0.1;
            pipe.passed = true;

            if(score >= 4.0){
                score = 4.0;
                gameOver = true;
            }
        }
    });

    // Collisions with ground/ceiling
    if(bird.y + bird.height >= canvas.height || bird.y <= 0){
        gameOver = true;
    }

    // Draw score
    if(!gameOver){
        ctx.textAlign = "left";
        ctx.fillStyle = "white";
        ctx.font = "25px Arial";
        ctx.fillText("CG: " + score.toFixed(1), 10, 40);
    }

    // Game Over
    if(gameOver){
        if(!gameOverPlayed){
            gameOverSound.play().catch(()=>{});
            gameOverPlayed = true;

            setTimeout(() => {
                canRestart = true;
            }, 3000);
        }

        ctx.textAlign = "center";

        ctx.fillStyle = "yellow";
        ctx.font = "60px Arial";
        ctx.fillText("CG: " + score.toFixed(1), canvas.width/2, 250);

        if(score >= 4.0){
            ctx.fillStyle = "green";
            ctx.font = "30px Arial";
            ctx.fillText("‡¶Ü‡¶≤‡¶æ‡¶Æ‡¶ø‡¶® ‡¶™‡¶æ‡¶∏!", canvas.width/2, 350);
        } else {
            ctx.fillStyle = "red";
            ctx.font = "24px Arial";
            ctx.fillText("‡¶Ü‡¶≤‡¶æ‡¶Æ‡¶ø‡¶®‡ßá‡¶∞ CG ‡¶∞ ‡¶è‡¶á ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ ‡¶ï‡ßá‡¶®üòë", canvas.width/2, 350);
            ctx.font = "18px Arial";
            ctx.fillText("Tap for Retake", canvas.width/2, 390);
        }

        return; // stop game loop
    }

    frame++;
    requestAnimationFrame(draw);
}

draw();
</script>

</body>
</html>

